# 예약 시스템 설정 가이드

## 1. 데이터베이스 설정

HeidiSQL에서 `database_attendance.sql` 파일을 실행하여 테이블을 생성하세요.

## 2. 예약 오더 처리 스크립트 실행

### 방법 1: 크론잡 설정 (권장)

카페24 호스팅에서 크론잡을 설정하거나, GCP 서버에서 실행:

```bash
# GCP 서버에서
cd /root/mailcenter/sound
# 매 1분마다 실행
*/1 * * * * php /path/to/tracker/process_reservations.php >> /path/to/tracker/reservation.log 2>&1
```

### 방법 2: API 호출

`save_order.php`에서 자동으로 처리하도록 설정되어 있습니다.

## 3. 웹문자 발송 설정 (TODO)

현재는 로그만 남기고 있습니다. 실제 웹문자 발송을 위해 다음 중 하나를 선택하세요:

### 옵션 1: 카카오톡 비즈니스 API
- 카카오톡 비즈니스 계정 필요
- API 키 발급 후 `process_reservations.php`의 `send_web_message()` 함수 수정

### 옵션 2: 알리고 (Aligo)
- 알리고 계정 필요
- API 연동 코드 추가

### 옵션 3: 문자나라
- 문자나라 계정 필요
- API 연동 코드 추가

## 4. 메일 발송

카페24 호스팅의 `mail()` 함수를 사용합니다.
수신 이메일: `okmoising@gmail.com` (고정)

## 5. 테스트 모드

관리자 페이지에서 테스트 모드를 활성화하면:
- 실제 전화번호 대신 테스트 전화번호로 발송
- 예약 오더 관리 페이지에서 테스트 모드 설정 가능

## 6. 예약 오더 처리 로직

1. 오늘 날짜의 출근부에서 매니저 이름 검색
2. 시간 범위 내의 출근 시간 필터링
3. 조건(가장 빠른/늦은 시간)에 따라 시간 선택
4. 타임 수만큼 시간 선택
5. 전화번호 찾아서 웹문자 발송
6. 발송 결과 로그 저장
7. 메일 발송

## 7. 예약 오더 파싱 규칙

- **이름**: "김나나" → 매니저 이름
- **시간 범위**: "18~20" → 18시부터 20시까지
- **조건**: "가장 늦은시간" → latest, "가장 빠른시간" → earliest
- **타임 수**: "1타임" → 1개 시간 선택, "2타임" → 2개 시간 선택

### 예시
- 입력: "김나나 18~20 가장 늦은시간 1타임"
- 처리: 18, 19, 20 중 가장 늦은 시간 1개 → 20시
- 발송: "김나나 20 예약 부탁드려요"

## 8. 주의사항

- 출근부는 밤 9시~11시 사이에 업데이트됨
- 예약 오더는 출근부가 업데이트된 후 처리됨
- 테스트 모드에서는 실제 전화번호로 발송되지 않음


